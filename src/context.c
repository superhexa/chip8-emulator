#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "context.h"

static const uint8_t font[80] = {
    0xF0,0x90,0x90,0x90,0xF0,
    0x20,0x60,0x20,0x20,0x70,
    0xF0,0x10,0xF0,0x80,0xF0,
    0xF0,0x10,0xF0,0x10,0xF0,
    0x90,0x90,0xF0,0x10,0x10,
    0xF0,0x80,0xF0,0x10,0xF0,
    0xF0,0x80,0xF0,0x90,0xF0,
    0xF0,0x10,0x20,0x40,0x40,
    0xF0,0x90,0xF0,0x90,0xF0,
    0xF0,0x90,0xF0,0x10,0xF0,
    0xF0,0x90,0xF0,0x90,0x90,
    0xE0,0x90,0xE0,0x90,0xE0,
    0xF0,0x80,0x80,0x80,0xF0,
    0xE0,0x90,0x90,0x90,0xE0,
    0xF0,0x80,0xF0,0x80,0xF0,
    0xF0,0x80,0xF0,0x80,0x80
};

void init_ctx(Context* ctx) {
    memset(ctx, 0, sizeof(Context));
    ctx->pc = ROM_START;
    memcpy(ctx->mem + FONT_START, font, sizeof(font));
    ctx->halt = 0;
    ctx->wait = 0;
}

void load_rom(Context* ctx, const char* path) {
    FILE* f = fopen(path, "rb");
    if (!f) exit(1);
    fseek(f, 0, SEEK_END);
    long size = ftell(f);
    rewind(f);
    fread(ctx->mem + ROM_START, size, 1, f);
    fclose(f);
}
